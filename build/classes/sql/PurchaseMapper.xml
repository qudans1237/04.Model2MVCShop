<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PurchaseMapper">


	<resultMap id="purchaseSelectMap" type="purchase">
		<result property="tranNo" 			   column="TRAN_NO" 	  		jdbcType="INTEGER"/>
		<result property="purchaseProd.prodNo" column="PROD_NO"       		jdbcType="INTEGER"/>
		<result property="buyer.userId" 	   column="BUYER_ID"       		jdbcType="VARCHAR"/>
		<result property="paymentOption" 	   column="PAYMENT_OPTION" 		jdbcType="CHAR"/>
		<result property="receiverName"		   column="RECEIVER_NAME"  		jdbcType="VARCHAR"/>
		<result property="receiverPhone" 	   column="RECEIVER_PHONE" 		jdbcType="VARCHAR"/>
		<result property="divyAddr" 		   column="DLVY_ADDR" 			jdbcType="VARCHAR"/>
		<result property="divyRequest" 		   column="DLVY_REQUEST" 		jdbcType="VARCHAR"/>
		<result property="tranCode" 		   column="TRAN_STATUS_CODE"	jdbcType="CHAR"/>
		<result property="orderDate" 		   column="ORDER_DATE" 			jdbcType="DATE"/>
		<result property="divyDate" 		   column="DLVY_DATE" 			jdbcType="DATE"/>
	</resultMap>

	

	<insert id="addPurchase" parameterType="purchase">
		INSERT
		INTO
		transaction VALUES
		(seq_transaction_tran_no.NEXTVAL,#{purchaseProd.prodNo:INTEGER},#{buyer.userId:VARCHAR},#{paymentOption:CHAR},#{receiverName:VARCHAR},#{receiverPhone:VARCHAR},#{divyAddr:VARCHAR},#{divyRequest:VARCHAR},'001',SYSDATE,#{divyDate:DATE}) 
	</insert>

	<select id="getPurchase" resultMap="purchaseSelectMap" parameterType="int">
		SELECT
		prod_no, buyer_id, payment_option, receiver_name, receiver_phone, demailaddr, dlvy_request, dlvy_date, order_date,
		tran_status_code, tran_no
		FROM 
		transactionWHERE tran_no = #{tranNo:INTEGER}
	</select>
	
	<select id="getPurchase2" resultMap="purchaseSelectMap" parameterType="int">
		SELECT
		t.tran_no
		FROM 
		transaction t, product p
		WHERE t.prod_no = p.prod_no
		and p.prod_no = #{purchaseProd.prodNo:INTEGER}
	</select>
	
	<update	id="updatePurchase"	parameterType="purchase" >
		UPDATE 
		transaction 
		SET 
		payment_option=#{paymentOption:CHAR}, receiver_name=#{receiverName:VARCHAR}, receiver_phone=#{receiverPhone:VARCHAR}, demailaddr=?, DLVY_REQUEST=?, DLVY_DATE=?   where Tran_No=?
	</update>
</mapper>